---
import { Menu, X, Phone, Mail } from 'lucide-astro';
---

<header id="header" class="fixed top-0 left-0 right-0 transition-all duration-300 bg-white/[var(--bg-opacity)] [--bg-opacity:70%] backdrop-blur-md border-b border-black/5 overflow-visible z-[99999] header-animate w-full">

  <div class="container-custom">

    <nav class="flex items-center justify-between py-4">
      
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2">
        <span class="text-xl font-bold text-gray-900">Teseaa</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center space-x-8">
        <a href="/" class="nav-link">Inicio</a>
        <div class="relative group">
          <a href="/servicios" class="nav-link flex items-center">
            Servicios
            <svg class="ml-1 w-4 h-4 transition-transform group-hover:rotate-180" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </a>
          <div class="absolute top-full left-0 mt-2 w-48 glass rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="py-2">
              <a href="/servicios/venta" class="block px-4 py-2 text-gray-700 hover:bg-white/20 transition-colors">Venta</a>
              <a href="/servicios/instalacion" class="block px-4 py-2 text-gray-700 hover:bg-white/20 transition-colors">Instalación</a>
              <a href="/servicios/mantenimiento" class="block px-4 py-2 text-gray-700 hover:bg-white/20 transition-colors">Mantenimiento</a>
            </div>
          </div>
        </div>
        <a href="/nosotros" class="nav-link">Nosotros</a>
        <a href="/contacto" class="nav-link">Contacto</a>
      </div>

      <!-- Contact Info -->
      <div class="hidden md:flex items-center space-x-4">
        <a href="tel:954647966" class="flex items-center space-x-2 text-primary-600 hover:text-primary-700 transition-colors">
          <Phone class="w-4 h-4" />
          <span class="text-sm font-medium">+34 954 647 966</span>
        </a>
        <a href="/contacto" class="btn-primary">Contactar</a>
      </div>

      <!-- Mobile Menu Button -->
      <button id="mobile-menu-btn" class="lg:hidden p-2 text-gray-600 hover:text-gray-900">
        <Menu class="w-6 h-6" id="menu-icon" />
        <X class="w-6 h-6 hidden" id="close-icon" />
      </button>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="lg:hidden fixed inset-0 top-16 glass-dark backdrop-blur-xl z-40 opacity-0 invisible transition-all duration-300">
    <div class="container-custom py-8">
      <div class="flex flex-col space-y-6">
        <a href="/" class="text-lg font-medium text-white hover:text-primary-300 transition-colors">Inicio</a>
        <div class="space-y-3">
          <a href="/servicios" class="text-lg font-medium text-white hover:text-primary-300 transition-colors">Servicios</a>
          <div class="pl-4 space-y-2">
            <a href="/servicios/venta" class="block text-gray-300 hover:text-white transition-colors">Venta</a>
            <a href="/servicios/instalacion" class="block text-gray-300 hover:text-white transition-colors">Instalación</a>
            <a href="/servicios/mantenimiento" class="block text-gray-300 hover:text-white transition-colors">Mantenimiento</a>
          </div>
        </div>
        <a href="/nosotros" class="text-lg font-medium text-white hover:text-primary-300 transition-colors">Nosotros</a>
        <a href="/contacto" class="text-lg font-medium text-white hover:text-primary-300 transition-colors">Contacto</a>
        
        <div class="pt-6 border-t border-white/20">
          <a href="tel:954647966" class="flex items-center space-x-2 text-primary-300 mb-4">
            <Phone class="w-5 h-5" />
            <span class="font-medium">+34 954 647 966</span>
          </a>
          <a href="/contacto" class="btn-primary w-full text-center">Contactar ahora</a>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  #header.over-hero {
    --bg-opacity: 100%;
  }
  .nav-link {
    @apply text-gray-700 hover:text-primary-600 font-medium transition-colors duration-200;
  }
  
  /* #header.scrolled {
    @apply glass shadow-lg;
  } */
  
  #header.scrolled .nav-link {
    @apply text-gray-600 hover:text-primary-600;
  }
</style>

<script>
  // Header scroll effect
  window.addEventListener('scroll', () => {
    const header = document.getElementById('header');
    if (window.scrollY > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  });

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  mobileMenuBtn?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.contains('opacity-100');
    
    if (isOpen) {
      mobileMenu?.classList.remove('opacity-100', 'visible');
      mobileMenu?.classList.add('opacity-0', 'invisible');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    } else {
      mobileMenu?.classList.remove('opacity-0', 'invisible');
      mobileMenu?.classList.add('opacity-100', 'visible');
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');
    }
  });

  // Close mobile menu when clicking on a link
  document.querySelectorAll('#mobile-menu a').forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.remove('opacity-100', 'visible');
      mobileMenu?.classList.add('opacity-0', 'invisible');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    });
  });

  document.addEventListener('DOMContentLoaded', () => {
    const header = document.getElementById('header');
    const hero = document.getElementById('hero');

    if (header && hero) {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // Header está sobre el hero → fondo 100%
            header.classList.add('over-hero');
          } else {
            // Header ya no está sobre el hero → usar transparencia
            header.classList.remove('over-hero');
          }
        });
      }, {
        rootMargin: `-${header.offsetHeight}px 0px 0px 0px`,
        threshold: 0
      });

      observer.observe(hero);
    }
  });
</script>